# チャートデータ仕様

Yes/Noチャートは以下の情報で構成される。

* チャート名
* チャートタイプ（decision/point）
* 設問と選択肢、遷移先
* 診断結果リスト

これらをCSVファイルで設定する。さらに、設定アプリは、CSVファイルをIChart型のオブジェクトに変換し、サーバに登録する。また、チャートアプリは、IChart型のオブジェクトを用いてYes/Noチャートを表示する。



## CSV仕様

CSVファイルは、utf-8 BOM付きとする。CSVファイルの中身は3つのパートからなり、各パートの間は1行の空行を挿入する。



### 基本情報パート

| 行番号 | 項目名         | 内容                                                     |
| ------ | -------------- | -------------------------------------------------------- |
| 1      | チャート名     | このチャートの名前。同じ名前のチャートがあってはならない |
| 2      | チャートタイプ | decision または point                                    |



### 設問パート

設問パートの1行目はヘッダ行とし、カラムの項目名を記述する。2行目以降が設問データとなる。下表は、1行の設問データの構成を示す。

| カラム番号 | 項目名                | 内容                                                         |
| ---------- | --------------------- | ------------------------------------------------------------ |
| 1          | 設問ID                | 1から順番                                                    |
| 2          | 最終フラグ            | 最終設問かどうか（1なら最終設問、0なら途中）                 |
| 3          | 設問文                | 設問の文章                                                   |
| 4          | 選択肢1の文言         | 選択肢のボタンラベルになる                                   |
| 5          | 選択肢2の文言         | 選択肢のボタンラベルになる                                   |
| 6          | 選択肢3の文言         | 選択肢のボタンラベルになる（空文字なら設問なし）             |
| 7          | 選択肢4の文言         | 選択肢のボタンラベルになる（空文字なら設問なし）             |
| 8          | 選択肢5の文言         | 選択肢のボタンラベルになる（空文字なら設問なし）             |
| 9          | 選択肢1の遷移先設問ID | 選択肢1の遷移先設問IDまたはポイント（最終設問の場合は診断結果ID） |
| 10         | 選択肢2の遷移先設問ID | 選択肢2の遷移先設問IDまたはポイント（最終設問の場合は診断結果ID） |
| 11         | 選択肢3の遷移先設問ID | 選択肢3の遷移先設問IDまたはポイント（最終設問の場合は診断結果ID）。設問なしなら空文字にする |
| 12         | 選択肢4の遷移先設問ID | 選択肢4の遷移先設問IDまたはポイント（最終設問の場合は診断結果ID）。設問なしなら空文字にする |
| 13         | 選択肢5の遷移先設問ID | 選択肢5の遷移先設問IDまたはポイント（最終設問の場合は診断結果ID）。設問なしなら空文字にする |



### 診断結果パート

診断結果パートの1行目はヘッダ行とし、カラムの項目名を記述する。2行目以降が診断結果データとなる。下表は、1行の診断結果データの構成を示す。

| カラム番号 | 項目名       | 内容                                                  |
| ---------- | ------------ | ----------------------------------------------------- |
| 1          | 診断結果ID   | 1から順番                                             |
| 2          | ポイント下限 | チャートタイプがpointの場合に参照。それ以外なら空文字 |
| 3          | ポイント上限 | チャートタイプがpointの場合に参照。それ以外なら空文字 |
| 4          | 表示文章     | 診断結果の文章                                        |



## IChart型

IChartオブジェクトは、以下のようなinterface型として定義する。

```typescript
interface IQuestion {
  id: number;       // 設問ID
  isLast: boolean;  // trueなら最終問題
  sentence: string;  // 設問文
  choises: string[]; // 選択肢（1〜5）
  nexts: number[];    // 遷移先の設問ID（またはisLast=trueなら診断結果ID）
}

interface IDiagnosis {
  id: number;       // 診断結果ID
  lower: number;    // ポイント加減
  upper: number;    // ポイント上限
  sentence: string;  // 診断結果の文章
}

interface IChart {
  name: string;
  type: string;
  questions: IQuestion[];
  diagnoses: IDiagnosis[];
}
```

なお、selectionsやnextsは、選択肢の数だけ要素を持てばよく、無駄な空要素を持つ必要はない。
